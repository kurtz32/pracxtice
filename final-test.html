<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Final Synchronization Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .header { 
            text-align: center; 
            margin-bottom: 30px; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; 
            border-radius: 10px;
        }
        .test-section { 
            margin: 25px 0; 
            padding: 20px; 
            border: 2px solid #e9ecef; 
            border-radius: 10px; 
            background: #f8f9fa;
        }
        .btn { 
            padding: 12px 24px; 
            margin: 8px; 
            background: #007bff; 
            color: white; 
            border: none; 
            cursor: pointer; 
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .btn:hover { 
            background: #0056b3; 
            transform: translateY(-2px);
        }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #1e7e34; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }
        .result { 
            margin: 15px 0; 
            padding: 15px; 
            background: #fff; 
            border: 1px solid #dee2e6; 
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success { 
            background: #d4edda !important; 
            border-color: #c3e6cb !important; 
            color: #155724 !important; 
        }
        .error { 
            background: #f8d7da !important; 
            border-color: #f5c6cb !important; 
            color: #721c24 !important; 
        }
        .info { 
            background: #d1ecf1 !important; 
            border-color: #bee5eb !important; 
            color: #0c5460 !important; 
        }
        .warning { 
            background: #fff3cd !important; 
            border-color: #ffeaa7 !important; 
            color: #856404 !important; 
        }
        .current-data { 
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); 
            border: 2px solid #fd7e14; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 10px; 
            color: #8b4513;
        }
        .instructions { 
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); 
            border: 2px solid #2196f3; 
            padding: 20px; 
            margin: 20px 0; 
            border-radius: 10px; 
            color: #0d47a1;
        }
        .step { 
            margin: 10px 0; 
            padding: 12px; 
            background: rgba(255,255,255,0.8); 
            border-radius: 6px; 
            border-left: 4px solid #2196f3;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ Final Synchronization Test</h1>
            <p>Complete test suite for admin panel and main page synchronization</p>
        </div>

        <div class="instructions">
            <h3>ğŸ“‹ Test Instructions</h3>
            <div class="step"><strong>Step 1:</strong> Check current API data below</div>
            <div class="step"><strong>Step 2:</strong> Open admin panel and login (admin/admin123)</div>
            <div class="step"><strong>Step 3:</strong> Make a small change (e.g., add " - Updated" to your name)</div>
            <div class="step"><strong>Step 4:</strong> Save changes and watch for success message</div>
            <div class="step"><strong>Step 5:</strong> Return here and click "Verify Sync" to check if changes appear</div>
            <div class="step"><strong>Step 6:</strong> Open main page to see changes live</div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š Current API Data Status</h3>
            <div id="currentData" class="current-data">
                Loading current data...
            </div>
            <button class="btn" onclick="loadCurrentData()">ğŸ”„ Refresh Data</button>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª Test Suite</h3>
            <button class="btn btn-success" onclick="runFullTest()">ğŸš€ Run Full Test Suite</button>
            <button class="btn btn-warning" onclick="verifySync()">âœ… Verify Synchronization</button>
            <button class="btn" onclick="testAdminSave()">ğŸ’¾ Test Admin Save</button>
            <button class="btn" onclick="testMainPageSync()">ğŸŒ Test Main Page Sync</button>
            <button class="btn btn-danger" onclick="clearResults()">ğŸ—‘ï¸ Clear Results</button>
        </div>

        <div class="test-section">
            <h3>ğŸ”— Quick Access</h3>
            <button class="btn" onclick="openAdminPanel()">âš™ï¸ Open Admin Panel</button>
            <button class="btn" onclick="openMainPage()">ğŸ  Open Main Page</button>
            <button class="btn" onclick="openSyncTest()">ğŸ”„ Open Sync Test</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“ Test Results</h3>
            <div id="results"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = window.location.origin;
        let testResults = [];
        
        function addResult(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const result = {
                timestamp,
                message,
                type
            };
            testResults.unshift(result);
            
            const resultsDiv = document.getElementById('results');
            const resultElement = document.createElement('div');
            resultElement.className = `result ${type}`;
            
            const statusClass = {
                'success': 'status-success',
                'error': 'status-error', 
                'warning': 'status-warning',
                'info': 'status-info'
            }[type] || 'status-info';
            
            resultElement.innerHTML = `
                <span class="status-indicator ${statusClass}"></span>
                <strong>[${timestamp}]</strong> ${message}
            `;
            
            resultsDiv.insertBefore(resultElement, resultsDiv.firstChild);
            
            // Keep only last 20 results
            while (resultsDiv.children.length > 20) {
                resultsDiv.removeChild(resultsDiv.lastChild);
            }
        }
        
        async function loadCurrentData() {
            addResult('Loading current API data...', 'info');
            
            try {
                const [aboutRes, contactRes] = await Promise.all([
                    fetch(`${API_BASE_URL}/api/about`),
                    fetch(`${API_BASE_URL}/api/contact`)
                ]);
                
                const aboutData = await aboutRes.json();
                const contactData = await contactRes.json();
                
                const currentDataDiv = document.getElementById('currentData');
                currentDataDiv.innerHTML = `
                    <h4>ğŸ“Š Current API Data:</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <strong>ğŸ‘¤ Personal Info:</strong><br>
                            â€¢ Name: ${aboutData.name || 'Not set'}<br>
                            â€¢ Profession: ${aboutData.profession || 'Not set'}<br>
                            â€¢ Projects: ${aboutData.projects || 'Not set'}<br>
                            â€¢ Experience: ${aboutData.experience || 'Not set'} years
                        </div>
                        <div>
                            <strong>ğŸ“ Contact Info:</strong><br>
                            â€¢ Email: ${contactData.email || 'Not set'}<br>
                            â€¢ Phone: ${contactData.phone || 'Not set'}<br>
                            â€¢ Location: ${contactData.location || 'Not set'}
                        </div>
                    </div>
                    <div style="margin-top: 10px; font-size: 12px; opacity: 0.7;">
                        Last updated: ${new Date().toLocaleString()}
                    </div>
                `;
                
                addResult('âœ… Current data loaded successfully', 'success');
                return { aboutData, contactData };
                
            } catch (error) {
                addResult('âŒ Failed to load current data: ' + error.message, 'error');
                return null;
            }
        }
        
        async function runFullTest() {
            addResult('ğŸš€ Starting full test suite...', 'info');
            
            // Test 1: Load current data
            const currentData = await loadCurrentData();
            if (!currentData) return;
            
            // Test 2: Test API save functionality
            addResult('Testing API save functionality...', 'info');
            const testData = {
                name: currentData.aboutData.name + ' - Test',
                profession: currentData.aboutData.profession,
                bio: currentData.aboutData.bio,
                projects: currentData.aboutData.projects,
                clients: currentData.aboutData.clients,
                experience: currentData.aboutData.experience,
                skills: currentData.aboutData.skills || []
            };
            
            try {
                const saveResponse = await fetch(`${API_BASE_URL}/api/about`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                
                const saveResult = await saveResponse.json();
                
                if (saveResponse.ok) {
                    addResult('âœ… API save test successful', 'success');
                    
                    // Verify the save
                    setTimeout(async () => {
                        const verifyData = await loadCurrentData();
                        if (verifyData && verifyData.aboutData.name.includes('Test')) {
                            addResult('âœ… Save verification successful', 'success');
                        } else {
                            addResult('âš ï¸ Save verification unclear', 'warning');
                        }
                    }, 1000);
                    
                } else {
                    addResult('âŒ API save test failed: ' + JSON.stringify(saveResult), 'error');
                }
                
            } catch (error) {
                addResult('âŒ API save test error: ' + error.message, 'error');
            }
            
            // Test 3: Test main page sync function
            addResult('Testing main page sync function...', 'info');
            if (typeof window.forceSyncNow === 'function') {
                const syncResult = await window.forceSyncNow();
                addResult(syncResult ? 'âœ… Main page sync function works' : 'âŒ Main page sync function failed', syncResult ? 'success' : 'error');
            } else {
                addResult('âš ï¸ Main page sync function not available (open main page first)', 'warning');
            }
            
            addResult('ğŸ Full test suite completed', 'info');
        }
        
        async function verifySync() {
            addResult('ğŸ” Verifying synchronization...', 'info');
            
            const currentData = await loadCurrentData();
            if (!currentData) return;
            
            addResult('Sync verification completed. Check if the data above matches your latest admin panel changes.', 'info');
        }
        
        async function testAdminSave() {
            addResult('ğŸ§ª Testing admin save functionality...', 'info');
            
            // Open admin panel
            window.open(`${API_BASE_URL}/admin.html`, '_blank');
            addResult('ğŸ“‹ Admin panel opened. Please login and make a test change.', 'info');
        }
        
        async function testMainPageSync() {
            addResult('ğŸŒ Testing main page synchronization...', 'info');
            
            // Open main page
            window.open(`${API_BASE_URL}/index.html`, '_blank');
            addResult('ğŸ  Main page opened. Changes should appear automatically within 5 seconds.', 'info');
        }
        
        function openAdminPanel() {
            window.open(`${API_BASE_URL}/admin.html`, '_blank');
            addResult('âš™ï¸ Admin panel opened', 'info');
        }
        
        function openMainPage() {
            window.open(`${API_BASE_URL}/index.html`, '_blank');
            addResult('ğŸ  Main page opened', 'info');
        }
        
        function openSyncTest() {
            window.open(`${API_BASE_URL}/sync-test.html`, '_blank');
            addResult('ğŸ”„ Sync test page opened', 'info');
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
            testResults = [];
            addResult('ğŸ—‘ï¸ Results cleared', 'info');
        }
        
        // Auto-load data when page loads
        window.addEventListener('load', async function() {
            addResult('ğŸ¯ Final synchronization test page loaded', 'info');
            await loadCurrentData();
            
            // Auto-refresh data every 30 seconds
            setInterval(loadCurrentData, 30000);
        });
    </script>
</body>
</html>